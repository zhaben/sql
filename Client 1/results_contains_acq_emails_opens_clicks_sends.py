# -*- coding: utf-8 -*-
"""Results Contains ACQ Emails Opens/Clicks/Sends.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1BzLLCu9k9Hb50T_ZBWVerDKZXxDbEd3H

Results Contains ACQ Emails Opens

Integration:PrestoPurpose:Contact Event Data
"""

SELECT 
  email
  ,emailname
  --,sendid
  ,cast(to_unixtime(try(date_add('hour', 6, from_iso8601_timestamp(replace(substr(eventdate,1,19), ' ', 'T'))))) as bigint) as ts
  --,event
  ,CONCAT(email,emailname,sendid,eventdate) AS unique_id
FROM et_opens_deduped 
where UPPER(emailname) like '%ACQ%'

"""Results Contains ACQ Emails Clicks"""

SELECT 
  email
  ,emailname
  ,url
  --,sendid
  ,cast(to_unixtime(try(date_add('hour', 6, from_iso8601_timestamp(replace(substr(eventdate,1,19), ' ', 'T'))))) as bigint) as ts
  --,event
  ,substr(to_base64(cast(COALESCE(email,'')||COALESCE(emailname,'')||COALESCE(sendid,'')||COALESCE(url,'')||COALESCE(eventdate,'') as varbinary)), 1, 200) as unique_id
FROM et_clicks_deduped 
where UPPER(emailname) like '%ACQ%'

"""Results Contains ACQ Emails Sends"""

SELECT 
  email
  ,emailname
  --,sendid
  ,cast(to_unixtime(try(date_add('hour', 6, from_iso8601_timestamp(replace(substr(eventdate,1,19), ' ', 'T'))))) as bigint) as ts
  --,event
  ,CONCAT(email,emailname,sendid,eventdate) AS unique_id
FROM et_sends_deduped 
where UPPER(emailname) like '%ACQ%'